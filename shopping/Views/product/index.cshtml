


<h2>Products</h2>
<button onclick="openModal(null)">Add Product</button>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Price</th>
            
        </tr>
    </thead>
    <tbody id="tableBody">
    </tbody>
</table>

<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Create Product</h5>
            </div>
            <div class="modal-body">
                <form class="needs-validation" action="" novalidate method="">
                    <input hidden id="item-id" />

                    <div class="row">
                        <div class="col-4">
                            <label for="item-name" class="form-label"> Name</label>
                            <input id="item-name" maxlength="20" minlength="3" type="text" pattern="^[A-Za-z]+$" class="form-control" required />
                            <div class="invalid-feedback">
                                Please use criteria.
                            </div>
                        </div>
                        <div class="col-4">
                            <label for="item-price" class="form-label"> Price</label>
                            <input id="item-price" type="number" step="0.01" pattern="^\d+(,\d{1,2})?$" class="form-control" required />
                            <div class="invalid-feedback">
                                Please use criteria.
                            </div>
                        </div>
                      
                        <div class="col-6">
                            <button type="submit" class="btn-btn-primary">Submit</button>
                            <button type="button" class="btn-btn-primary" id="back">Back</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
  
@section Scripts {
    <script defer>
        var Products = [];
        var getProducts = async () => {
            const data = await fetchData("/Product/GetProductlist");
            return(data);
        }

            var openModal = async (id) => {
            let product = { id: null, name: '', price: '' };
            if (id) {
                product = await fetchData("/Product/GetProduct?id=" + id);
                //api call to get details of product using id;
            }
           // console.log(id, product, typeof product);
            $('#item-name').val(product.name);
            $('#item-price').val(product.price);
            $('#item-id').val(product.id);
            $('#id-display').text(id);
            $('#exampleModalCenter').modal('show'); // todo: how to pass data to
        }
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')


            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        console.log(event)
                        if (!form.checkValidity()) {
                            $(form).find("input").get().forEach(e => $(e).siblings(".invalid-feedback").html(e.validationMessage));
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        else {
                            PostProductData()
                        }

                        form.classList.add('was-validated')
                    }, false)
                })
        })()
        var saveProduct = (Product) => {
            //api call to save product
            alert("product saved");
        }

        var deleteProduct = async (id) => 
        {
            //api call to delete product from id;
            const url = '/Product/DeleteProduct/?id=' + id;
            const onSuccess = () => { getProducts().then(products => populateList(products,"Products")); }
            DeleteData(url, onSuccess);  
            
          
        }

        //create a function to post to given url
        async function PostProductData() {
            const product = {};
           product.Name = $("#item-name").val();
            product.Price = parseFloat($("#item-price").val()) || 0;
            if (parseInt($("#item-id").val()))product.id = parseInt($("#item-id").val());
            const url = '/Product/AddProduct';
            const onSuccess = () => { getProducts().then(products => populateList(products,"Products")); $('#exampleModalCenter').modal('hide'); }

            if (product.id) {
                url = '/Product/UpdateProduct';
                PutData(url, product, onSuccess);
            }
            else {
                postData(url, product, onSuccess);

            }

           
            

        }

        getProducts().then(products => populateList(products, "Products"));
       

        $('#back').on('click', function () {
            $('exampleModalCenter').modal('hide');
        });
      
    </script>

    }

